{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL='http://localhost:3000/api';const SeleccionMateriasHorarios=()=>{const[availableMaterias,setAvailableMaterias]=useState([]);const[selectedMaterias,setSelectedMaterias]=useState([]);const[userCredits,setUserCredits]=useState(0);const[passedCourses,setPassedCourses]=useState([]);const[error,setError]=useState(null);const[loading,setLoading]=useState(true);const navigate=useNavigate();const getAuthHeaders=useCallback(()=>{const token=localStorage.getItem('token');return token?{'Authorization':`Bearer ${token}`}:{};},[]);const fetchUserData=useCallback(async()=>{try{const response=await axios.get(`${API_BASE_URL}/user-academic-info`,{headers:getAuthHeaders()});setUserCredits(response.data.totalCredits);setPassedCourses(response.data.approvedSubjects||[]);}catch(error){console.error('Error fetching user data:',error);setError('Failed to load your academic information. Please try again.');}},[getAuthHeaders]);const fetchAvailableMaterias=useCallback(async()=>{try{const response=await axios.get(`${API_BASE_URL}/all-subjects`,{headers:getAuthHeaders()});const filteredMaterias=response.data.filter(materia=>userCredits>=(materia.requerimiento_Creditos||0)).reduce((acc,current)=>{const x=acc.find(item=>item.materia_id===current.materia_id);if(!x){return acc.concat([current]);}else{return acc;}},[]);setAvailableMaterias(filteredMaterias);console.log('Materias filtradas:',filteredMaterias);}catch(error){console.error('Error fetching available subjects:',error);setError('Failed to load available courses. Please try again.');}finally{setLoading(false);}},[getAuthHeaders,userCredits]);useEffect(()=>{const loadData=async()=>{await fetchUserData();await fetchAvailableMaterias();};loadData();},[fetchUserData,fetchAvailableMaterias]);const isEligibleForCourse=materia=>{return!materia.prerequisito_materia_id||passedCourses.includes(materia.prerequisito_materia_id);};const handleSelect=materia=>{if(!isEligibleForCourse(materia)){const prerequisiteMateria=availableMaterias.find(m=>m.materia_id===materia.prerequisito_materia_id);setError(`No puedes llevar ${materia.materia_name} porque te falta aprobar ${prerequisiteMateria?prerequisiteMateria.materia_name:'un prerrequisito'}.`);return;}setSelectedMaterias(prev=>{const isAlreadySelected=prev.some(m=>m.materia_id===materia.materia_id);if(isAlreadySelected){return prev.filter(m=>m.materia_id!==materia.materia_id);}else{return[...prev,materia];}});setError(null);};const handleSubmit=()=>{if(selectedMaterias.length===0){setError('Por favor, selecciona al menos una materia.');return;}localStorage.setItem('selectedMaterias',JSON.stringify(selectedMaterias));navigate('/SeleccionHorarios');};if(loading){return/*#__PURE__*/_jsx(\"div\",{children:\"Cargando...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"materias-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Materias Disponibles\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Cr\\xE9ditos acumulados: \",userCredits]}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"error-msg\",children:error}),availableMaterias.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"materias-grid\",children:availableMaterias.map(materia=>/*#__PURE__*/_jsxs(\"div\",{className:\"materia-item\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"checkbox-materia\",type:\"checkbox\",id:`materia-${materia.materia_id}`,checked:selectedMaterias.some(m=>m.materia_id===materia.materia_id),onChange:()=>handleSelect(materia)}),/*#__PURE__*/_jsxs(\"label\",{className:`label-materia ${!isEligibleForCourse(materia)?'disabled':''}`,htmlFor:`materia-${materia.materia_id}`,children:[materia.materia_name,\" (Cr\\xE9ditos: \",materia.credits,\", Req. Cr\\xE9ditos: \",materia.requerimiento_Creditos||0,\")\",!isEligibleForCourse(materia)&&/*#__PURE__*/_jsx(\"span\",{className:\"prerequisite-warning\",children:\" (Prerrequisito no cumplido)\"})]})]},materia.materia_id))}):/*#__PURE__*/_jsx(\"p\",{className:\"no-materias-msg\",children:\"No hay materias disponibles para inscripci\\xF3n en este momento.\"}),/*#__PURE__*/_jsx(\"button\",{className:\"boton-guardar\",onClick:handleSubmit,disabled:selectedMaterias.length===0,children:\"Siguiente: Seleccionar Horarios\"})]});};export default SeleccionMateriasHorarios;","map":{"version":3,"names":["React","useState","useEffect","useCallback","axios","useNavigate","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","SeleccionMateriasHorarios","availableMaterias","setAvailableMaterias","selectedMaterias","setSelectedMaterias","userCredits","setUserCredits","passedCourses","setPassedCourses","error","setError","loading","setLoading","navigate","getAuthHeaders","token","localStorage","getItem","fetchUserData","response","get","headers","data","totalCredits","approvedSubjects","console","fetchAvailableMaterias","filteredMaterias","filter","materia","requerimiento_Creditos","reduce","acc","current","x","find","item","materia_id","concat","log","loadData","isEligibleForCourse","prerequisito_materia_id","includes","handleSelect","prerequisiteMateria","m","materia_name","prev","isAlreadySelected","some","handleSubmit","length","setItem","JSON","stringify","children","className","map","type","id","checked","onChange","htmlFor","credits","onClick","disabled"],"sources":["C:/Users/Francisco Chong/Desktop/Proyecto Final/frontengi/src/components/SeleccionMateriashorarios.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst API_BASE_URL = 'http://localhost:3000/api';\r\n\r\nconst SeleccionMateriasHorarios = () => {\r\n    const [availableMaterias, setAvailableMaterias] = useState([]);\r\n    const [selectedMaterias, setSelectedMaterias] = useState([]);\r\n    const [userCredits, setUserCredits] = useState(0);\r\n    const [passedCourses, setPassedCourses] = useState([]);\r\n    const [error, setError] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const navigate = useNavigate();\r\n\r\n    const getAuthHeaders = useCallback(() => {\r\n        const token = localStorage.getItem('token');\r\n        return token ? { 'Authorization': `Bearer ${token}` } : {};\r\n    }, []);\r\n\r\n    const fetchUserData = useCallback(async () => {\r\n        try {\r\n            const response = await axios.get(`${API_BASE_URL}/user-academic-info`, { headers: getAuthHeaders() });\r\n            setUserCredits(response.data.totalCredits);\r\n            setPassedCourses(response.data.approvedSubjects || []);\r\n        } catch (error) {\r\n            console.error('Error fetching user data:', error);\r\n            setError('Failed to load your academic information. Please try again.');\r\n        }\r\n    }, [getAuthHeaders]);\r\n\r\n    const fetchAvailableMaterias = useCallback(async () => {\r\n        try {\r\n            const response = await axios.get(`${API_BASE_URL}/all-subjects`, { headers: getAuthHeaders() });\r\n            const filteredMaterias = response.data\r\n                .filter(materia => userCredits >= (materia.requerimiento_Creditos || 0))\r\n                .reduce((acc, current) => {\r\n                    const x = acc.find(item => item.materia_id === current.materia_id);\r\n                    if (!x) {\r\n                        return acc.concat([current]);\r\n                    } else {\r\n                        return acc;\r\n                    }\r\n                }, []);\r\n            setAvailableMaterias(filteredMaterias);\r\n            console.log('Materias filtradas:', filteredMaterias);\r\n        } catch (error) {\r\n            console.error('Error fetching available subjects:', error);\r\n            setError('Failed to load available courses. Please try again.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [getAuthHeaders, userCredits]);\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            await fetchUserData();\r\n            await fetchAvailableMaterias();\r\n        };\r\n        loadData();\r\n    }, [fetchUserData, fetchAvailableMaterias]);\r\n\r\n    const isEligibleForCourse = (materia) => {\r\n        return !materia.prerequisito_materia_id || passedCourses.includes(materia.prerequisito_materia_id);\r\n    };\r\n\r\n    const handleSelect = (materia) => {\r\n        if (!isEligibleForCourse(materia)) {\r\n            const prerequisiteMateria = availableMaterias.find(m => m.materia_id === materia.prerequisito_materia_id);\r\n            setError(`No puedes llevar ${materia.materia_name} porque te falta aprobar ${prerequisiteMateria ? prerequisiteMateria.materia_name : 'un prerrequisito'}.`);\r\n            return;\r\n        }\r\n\r\n        setSelectedMaterias(prev => {\r\n            const isAlreadySelected = prev.some(m => m.materia_id === materia.materia_id);\r\n            if (isAlreadySelected) {\r\n                return prev.filter(m => m.materia_id !== materia.materia_id);\r\n            } else {\r\n                return [...prev, materia];\r\n            }\r\n        });\r\n        setError(null);\r\n    };\r\n\r\n    const handleSubmit = () => {\r\n        if (selectedMaterias.length === 0) {\r\n            setError('Por favor, selecciona al menos una materia.');\r\n            return;\r\n        }\r\n        localStorage.setItem('selectedMaterias', JSON.stringify(selectedMaterias));\r\n        navigate('/SeleccionHorarios');\r\n    };\r\n\r\n    if (loading) {\r\n        return <div>Cargando...</div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"materias-container\">\r\n            <h2>Materias Disponibles</h2>\r\n            <p>Créditos acumulados: {userCredits}</p>\r\n            {error && <p className=\"error-msg\">{error}</p>}\r\n            {availableMaterias.length > 0 ? (\r\n                <div className=\"materias-grid\">\r\n                    {availableMaterias.map(materia => (\r\n                        <div key={materia.materia_id} className=\"materia-item\">\r\n                            <input\r\n                                className=\"checkbox-materia\"\r\n                                type=\"checkbox\"\r\n                                id={`materia-${materia.materia_id}`}\r\n                                checked={selectedMaterias.some(m => m.materia_id === materia.materia_id)}\r\n                                onChange={() => handleSelect(materia)}\r\n                            />\r\n                            <label \r\n                                className={`label-materia ${!isEligibleForCourse(materia) ? 'disabled' : ''}`}\r\n                                htmlFor={`materia-${materia.materia_id}`}\r\n                            >\r\n                                {materia.materia_name} (Créditos: {materia.credits}, Req. Créditos: {materia.requerimiento_Creditos || 0})\r\n                                {!isEligibleForCourse(materia) && \r\n                                    <span className=\"prerequisite-warning\"> (Prerrequisito no cumplido)</span>\r\n                                }\r\n                            </label>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            ) : (\r\n                <p className=\"no-materias-msg\">No hay materias disponibles para inscripción en este momento.</p>\r\n            )}\r\n            <button \r\n                className=\"boton-guardar\" \r\n                onClick={handleSubmit} \r\n                disabled={selectedMaterias.length === 0}\r\n            >\r\n                Siguiente: Seleccionar Horarios\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SeleccionMateriasHorarios;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}