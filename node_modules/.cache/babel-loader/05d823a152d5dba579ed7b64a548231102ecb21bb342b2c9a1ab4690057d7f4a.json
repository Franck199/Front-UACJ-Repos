{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL='http://localhost:3000/api';const SeleccionMaterias=()=>{const[materias,setMaterias]=useState([]);const[selectedMaterias,setSelectedMaterias]=useState([]);const[error,setError]=useState(null);const[success,setSuccess]=useState(null);const[loading,setLoading]=useState(true);const getAuthHeaders=useCallback(()=>{const token=localStorage.getItem('token');return token?{'Authorization':`Bearer ${token}`}:{};},[]);const fetchData=useCallback(async(url,errorMessage)=>{try{const response=await axios.get(url,{headers:getAuthHeaders()});console.log(`Datos de ${url}:`,response.data);return response.data;}catch(error){console.error(`Error fetching data from ${url}:`,error);throw new Error(`${errorMessage} ${error.response?`(${error.response.status}: ${error.response.statusText})`:''}`);}},[getAuthHeaders]);useEffect(()=>{const loadInitialData=async()=>{try{setLoading(true);const[materiasData,historialData]=await Promise.all([fetchData(`${API_BASE_URL}/materias`,'Error al cargar materias.'),fetchData(`${API_BASE_URL}/check-historial`,'Error al cargar el historial academico.')]);setMaterias(materiasData);if(historialData&&historialData.historial){setSelectedMaterias(historialData.historial);}}catch(error){setError(error.message);}finally{setLoading(false);}};loadInitialData();},[fetchData]);const handleSelect=useCallback(materia=>{if(!materia||!materia.materia_id){setError('Ocurrio un error mienstras seleccionaba las materias. ID invalido');return;}setSelectedMaterias(prevSelected=>{const isAlreadySelected=prevSelected.some(item=>item.materia_id===materia.materia_id);if(isAlreadySelected){return prevSelected.filter(item=>item.materia_id!==materia.materia_id);}else{return[...prevSelected,{materia_id:materia.materia_id,status:'Aprobado',semestre:1}];}});},[]);const handleSubmit=async()=>{if(selectedMaterias.length===0){setError('No se ha podido procesar correctamente');return;}try{setLoading(true);const response=await axios.post(`${API_BASE_URL}/guardar-historial`,{materias:selectedMaterias},{headers:getAuthHeaders()});console.log('Materias guardadas:',response.data);setSuccess('Sus materias se han guardado correctamente.');setError(null);}catch(error){let errorMessage='Error al guardar sus materias. ';if(error.response){if(error.response.status===500){errorMessage+='Tenemos problemas con el servidor :(';}else{errorMessage+=`(${error.response.status}: ${error.response.statusText})`;}if(error.response.data&&error.response.data.message){errorMessage+=` Detalles: ${error.response.data.message}`;}}else if(error.request){errorMessage+='Tenemos problemas con el servidor.';}else{errorMessage+=error.message;}setError(errorMessage);setSuccess(null);}finally{setLoading(false);}};if(loading){return/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"materias-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Selecciona tus materias\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"error-msg\",children:error}),success&&/*#__PURE__*/_jsx(\"p\",{className:\"success-msg\",children:success}),materias.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"materias-grid\",children:materias.map(materia=>/*#__PURE__*/_jsxs(\"div\",{className:\"materia-item\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"checkbox-materia\",type:\"checkbox\",id:`materia-${materia.materia_id}`,checked:selectedMaterias.some(item=>item.materia_id===materia.materia_id),onChange:()=>handleSelect(materia)}),/*#__PURE__*/_jsx(\"label\",{className:\"label-materia\",htmlFor:`materia-${materia.materia_id}`,children:materia.materia_name})]},materia.materia_id))}):/*#__PURE__*/_jsx(\"p\",{className:\"no-materias-msg\",children:\"Materias no disponibles\"}),/*#__PURE__*/_jsx(\"button\",{className:\"boton-guardar\",onClick:handleSubmit,disabled:selectedMaterias.length===0||loading,children:loading?'Guardando...':'Guardar materias'})]});};export default SeleccionMaterias;","map":{"version":3,"names":["React","useState","useEffect","useCallback","axios","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","SeleccionMaterias","materias","setMaterias","selectedMaterias","setSelectedMaterias","error","setError","success","setSuccess","loading","setLoading","getAuthHeaders","token","localStorage","getItem","fetchData","url","errorMessage","response","get","headers","console","log","data","Error","status","statusText","loadInitialData","materiasData","historialData","Promise","all","historial","message","handleSelect","materia","materia_id","prevSelected","isAlreadySelected","some","item","filter","semestre","handleSubmit","length","post","request","children","className","map","type","id","checked","onChange","htmlFor","materia_name","onClick","disabled"],"sources":["C:/Users/Francisco Chong/Desktop/Proyecto Final/Front-UACJ-Repos/src/components/seleccion-materias.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst API_BASE_URL = 'http://localhost:3000/api';\r\n\r\nconst SeleccionMaterias = () => {\r\n    const [materias, setMaterias] = useState([]);\r\n    const [selectedMaterias, setSelectedMaterias] = useState([]);\r\n    const [error, setError] = useState(null);\r\n    const [success, setSuccess] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const getAuthHeaders = useCallback(() => {\r\n        const token = localStorage.getItem('token');\r\n        return token ? { 'Authorization': `Bearer ${token}` } : {};\r\n    }, []);\r\n\r\n    const fetchData = useCallback(async (url, errorMessage) => {\r\n        try {\r\n            const response = await axios.get(url, { headers: getAuthHeaders() });\r\n            console.log(`Datos de ${url}:`, response.data);\r\n            return response.data;\r\n        } catch (error) {\r\n            console.error(`Error fetching data from ${url}:`, error);\r\n            throw new Error(`${errorMessage} ${error.response ? `(${error.response.status}: ${error.response.statusText})` : ''}`);\r\n        }\r\n    }, [getAuthHeaders]);\r\n\r\n    useEffect(() => {\r\n        const loadInitialData = async () => {\r\n            try {\r\n                setLoading(true);\r\n                const [materiasData, historialData] = await Promise.all([\r\n                    fetchData(`${API_BASE_URL}/materias`, 'Error al cargar materias.'),\r\n                    fetchData(`${API_BASE_URL}/check-historial`, 'Error al cargar el historial academico.')\r\n                ]);\r\n\r\n                setMaterias(materiasData);\r\n                if (historialData && historialData.historial) {\r\n                    setSelectedMaterias(historialData.historial);\r\n                }\r\n            } catch (error) {\r\n                setError(error.message);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        loadInitialData();\r\n    }, [fetchData]);\r\n\r\n    const handleSelect = useCallback((materia) => {\r\n        if (!materia || !materia.materia_id) {\r\n            setError('Ocurrio un error mienstras seleccionaba las materias. ID invalido');\r\n            return;\r\n        }\r\n\r\n        setSelectedMaterias(prevSelected => {\r\n            const isAlreadySelected = prevSelected.some(item => item.materia_id === materia.materia_id);\r\n            if (isAlreadySelected) {\r\n                return prevSelected.filter(item => item.materia_id !== materia.materia_id);\r\n            } else {\r\n                return [...prevSelected, { \r\n                    materia_id: materia.materia_id, \r\n                    status: 'Aprobado', \r\n                    semestre: 1 \r\n                }];\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    const handleSubmit = async () => {\r\n        if (selectedMaterias.length === 0) {\r\n            setError('No se ha podido procesar correctamente');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setLoading(true);\r\n            const response = await axios.post(\r\n                `${API_BASE_URL}/guardar-historial`, \r\n                { materias: selectedMaterias },\r\n                { headers: getAuthHeaders() }\r\n            );\r\n            console.log('Materias guardadas:', response.data);\r\n            setSuccess('Sus materias se han guardado correctamente.');\r\n            setError(null);\r\n        } catch (error) {\r\n            let errorMessage = 'Error al guardar sus materias. ';\r\n            if (error.response) {\r\n                if (error.response.status === 500) {\r\n                    errorMessage += 'Tenemos problemas con el servidor :(';\r\n                } else {\r\n                    errorMessage += `(${error.response.status}: ${error.response.statusText})`;\r\n                }\r\n                if (error.response.data && error.response.data.message) {\r\n                    errorMessage += ` Detalles: ${error.response.data.message}`;\r\n                }\r\n            } else if (error.request) {\r\n                errorMessage += 'Tenemos problemas con el servidor.';\r\n            } else {\r\n                errorMessage += error.message;\r\n            }\r\n            setError(errorMessage);\r\n            setSuccess(null);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return <p>Loading...</p>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"materias-container\">\r\n    <h2>Selecciona tus materias</h2>\r\n    {error && <p className=\"error-msg\">{error}</p>}\r\n    {success && <p className=\"success-msg\">{success}</p>}\r\n    {materias.length > 0 ? (\r\n        <div className=\"materias-grid\">\r\n            {materias.map(materia => (\r\n                <div key={materia.materia_id} className=\"materia-item\">\r\n                    <input\r\n                        className=\"checkbox-materia\"\r\n                        type=\"checkbox\"\r\n                        id={`materia-${materia.materia_id}`}\r\n                        checked={selectedMaterias.some(item => item.materia_id === materia.materia_id)}\r\n                        onChange={() => handleSelect(materia)}\r\n                    />\r\n                    <label className=\"label-materia\" htmlFor={`materia-${materia.materia_id}`}>\r\n                        {materia.materia_name}\r\n                    </label>\r\n                </div>\r\n            ))}\r\n        </div>\r\n    ) : (\r\n        <p className=\"no-materias-msg\">Materias no disponibles</p>\r\n    )}\r\n    <button \r\n        className=\"boton-guardar\" \r\n        onClick={handleSubmit} \r\n        disabled={selectedMaterias.length === 0 || loading}\r\n    >\r\n        {loading ? 'Guardando...' : 'Guardar materias'}\r\n    </button>\r\n</div>\r\n\r\n    );\r\n};\r\n\r\nexport default SeleccionMaterias;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}