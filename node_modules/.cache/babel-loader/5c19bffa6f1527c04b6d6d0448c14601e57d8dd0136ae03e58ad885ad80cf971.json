{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL='http://localhost:3000/api';const SeleccionHorarios=()=>{const[selectedMaterias,setSelectedMaterias]=useState([]);const[franjasHorarias,setFranjasHorarias]=useState([]);const[selectedHorarios,setSelectedHorarios]=useState({});const[error,setError]=useState(null);const[success,setSuccess]=useState(null);const[loading,setLoading]=useState(true);const diasCombinaciones=[{id:1,dias:['Lunes','Miércoles']},{id:2,dias:['Martes','Jueves']}];const getAuthHeaders=useCallback(()=>{const token=localStorage.getItem('token');return token?{'Authorization':`Bearer ${token}`}:{};},[]);const fetchData=useCallback(async()=>{try{const storedMaterias=JSON.parse(localStorage.getItem('selectedMaterias')||'[]');setSelectedMaterias(storedMaterias);const franjasResponse=await axios.get(`${API_BASE_URL}/franjas-horarias`,{headers:getAuthHeaders()});console.log('Franjas horarias received:',franjasResponse.data);setFranjasHorarias(franjasResponse.data);}catch(error){console.error('Error fetching data:',error);setError('Failed to load time slots. Please try again.');}finally{setLoading(false);}},[getAuthHeaders]);useEffect(()=>{fetchData();},[fetchData]);const handleHorarioSelection=(materiaId,combinacionId,franjaId)=>{setSelectedHorarios(prev=>{var _prev$materiaId,_prev$materiaId2;return{...prev,[materiaId]:{...prev[materiaId],combinacionId:combinacionId||((_prev$materiaId=prev[materiaId])===null||_prev$materiaId===void 0?void 0:_prev$materiaId.combinacionId),franjaId:franjaId||((_prev$materiaId2=prev[materiaId])===null||_prev$materiaId2===void 0?void 0:_prev$materiaId2.franjaId)}};});};const handleSubmit=async()=>{if(Object.keys(selectedHorarios).length!==selectedMaterias.length){setError('Please select a time slot for each course.');return;}try{const data=selectedMaterias.map(materia=>{const horario=selectedHorarios[materia.materia_id];const diasSeleccionados=diasCombinaciones.find(c=>c.id===parseInt(horario.combinacionId)).dias;return{materia_id:materia.materia_id,dia_1:diasSeleccionados[0],dia_2:diasSeleccionados[1],franja_id:parseInt(horario.franjaId),semestre:1};});await axios.post(`${API_BASE_URL}/guardar-horarios`,data,{headers:getAuthHeaders()});setSuccess('Horarios guardados exitosamente');setError(null);localStorage.removeItem('selectedMaterias');}catch(error){console.error('Error saving schedules:',error);setError('Failed to save schedules. Please try again.');setSuccess(null);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"materias-container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"titulo-materias\",children:\"Selecci\\xF3n de Horarios\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:error}),success&&/*#__PURE__*/_jsx(\"p\",{style:{color:'green'},children:success}),selectedMaterias.map(materia=>{var _selectedHorarios$mat,_selectedHorarios$mat2;return/*#__PURE__*/_jsxs(\"div\",{className:\"materia-item\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"label-materia\",children:materia.materia_name}),diasCombinaciones.length>0&&/*#__PURE__*/_jsxs(\"select\",{className:\"dropdown-horario\",value:((_selectedHorarios$mat=selectedHorarios[materia.materia_id])===null||_selectedHorarios$mat===void 0?void 0:_selectedHorarios$mat.combinacionId)||\"\",onChange:e=>handleHorarioSelection(materia.materia_id,e.target.value,null),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"Selecciona D\\xEDas\"}),diasCombinaciones.map(combinacion=>/*#__PURE__*/_jsx(\"option\",{value:combinacion.id,children:combinacion.dias.join(' y ')},combinacion.id))]}),franjasHorarias.length>0&&/*#__PURE__*/_jsxs(\"select\",{className:\"dropdown-horario\",value:((_selectedHorarios$mat2=selectedHorarios[materia.materia_id])===null||_selectedHorarios$mat2===void 0?void 0:_selectedHorarios$mat2.franjaId)||\"\",onChange:e=>handleHorarioSelection(materia.materia_id,null,e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"Selecciona Horario\"}),franjasHorarias.map(franja=>/*#__PURE__*/_jsxs(\"option\",{value:franja.franja_id,children:[franja.hora_inicio,\" - \",franja.hora_fin]},franja.franja_id))]})]},materia.materia_id);}),/*#__PURE__*/_jsx(\"button\",{className:\"boton-guardar\",onClick:handleSubmit,children:\"Guardar Selecci\\xF3n\"})]});};export default SeleccionHorarios;","map":{"version":3,"names":["React","useState","useEffect","useCallback","axios","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","SeleccionHorarios","selectedMaterias","setSelectedMaterias","franjasHorarias","setFranjasHorarias","selectedHorarios","setSelectedHorarios","error","setError","success","setSuccess","loading","setLoading","diasCombinaciones","id","dias","getAuthHeaders","token","localStorage","getItem","fetchData","storedMaterias","JSON","parse","franjasResponse","get","headers","console","log","data","handleHorarioSelection","materiaId","combinacionId","franjaId","prev","_prev$materiaId","_prev$materiaId2","handleSubmit","Object","keys","length","map","materia","horario","materia_id","diasSeleccionados","find","c","parseInt","dia_1","dia_2","franja_id","semestre","post","removeItem","children","className","style","color","_selectedHorarios$mat","_selectedHorarios$mat2","materia_name","value","onChange","e","target","disabled","combinacion","join","franja","hora_inicio","hora_fin","onClick"],"sources":["C:/Users/Francisco Chong/Desktop/Proyecto Final/frontengi/src/components/SeleccionHorarios.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst API_BASE_URL = 'http://localhost:3000/api';\r\n\r\nconst SeleccionHorarios = () => {\r\n    const [selectedMaterias, setSelectedMaterias] = useState([]);\r\n    const [franjasHorarias, setFranjasHorarias] = useState([]);\r\n    const [selectedHorarios, setSelectedHorarios] = useState({});\r\n    const [error, setError] = useState(null);\r\n    const [success, setSuccess] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const diasCombinaciones = [\r\n        { id: 1, dias: ['Lunes', 'Miércoles'] },\r\n        { id: 2, dias: ['Martes', 'Jueves'] }\r\n    ];\r\n\r\n    const getAuthHeaders = useCallback(() => {\r\n        const token = localStorage.getItem('token');\r\n        return token ? { 'Authorization': `Bearer ${token}` } : {};\r\n    }, []);\r\n\r\n    const fetchData = useCallback(async () => {\r\n        try {\r\n            const storedMaterias = JSON.parse(localStorage.getItem('selectedMaterias') || '[]');\r\n            setSelectedMaterias(storedMaterias);\r\n\r\n            const franjasResponse = await axios.get(`${API_BASE_URL}/franjas-horarias`, { headers: getAuthHeaders() });\r\n            console.log('Franjas horarias received:', franjasResponse.data);\r\n            setFranjasHorarias(franjasResponse.data);\r\n        } catch (error) {\r\n            console.error('Error fetching data:', error);\r\n            setError('Failed to load time slots. Please try again.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [getAuthHeaders]);\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, [fetchData]);\r\n\r\n    const handleHorarioSelection = (materiaId, combinacionId, franjaId) => {\r\n        setSelectedHorarios(prev => ({\r\n            ...prev,\r\n            [materiaId]: { \r\n                ...prev[materiaId],\r\n                combinacionId: combinacionId || prev[materiaId]?.combinacionId,\r\n                franjaId: franjaId || prev[materiaId]?.franjaId\r\n            }\r\n        }));\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        if (Object.keys(selectedHorarios).length !== selectedMaterias.length) {\r\n            setError('Please select a time slot for each course.');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const data = selectedMaterias.map(materia => {\r\n                const horario = selectedHorarios[materia.materia_id];\r\n                const diasSeleccionados = diasCombinaciones.find(c => c.id === parseInt(horario.combinacionId)).dias;\r\n                return {\r\n                    materia_id: materia.materia_id,\r\n                    dia_1: diasSeleccionados[0],\r\n                    dia_2: diasSeleccionados[1],\r\n                    franja_id: parseInt(horario.franjaId),\r\n                    semestre: 1\r\n                };\r\n            });\r\n\r\n            await axios.post(`${API_BASE_URL}/guardar-horarios`, data, { headers: getAuthHeaders() });\r\n            setSuccess('Horarios guardados exitosamente');\r\n            setError(null);\r\n            localStorage.removeItem('selectedMaterias');\r\n        } catch (error) {\r\n            console.error('Error saving schedules:', error);\r\n            setError('Failed to save schedules. Please try again.');\r\n            setSuccess(null);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return <div>Loading...</div>;\r\n    }\r\n\r\n        return (\r\n            <div className=\"materias-container\">\r\n                <h2 className=\"titulo-materias\">Selección de Horarios</h2>\r\n                {error && <p style={{color: 'red'}}>{error}</p>}\r\n                {success && <p style={{color: 'green'}}>{success}</p>}\r\n                {selectedMaterias.map(materia => (\r\n                    <div className=\"materia-item\" key={materia.materia_id}>\r\n                        <h3 className=\"label-materia\">{materia.materia_name}</h3>\r\n                        {diasCombinaciones.length > 0 && (\r\n                            <select\r\n                                className=\"dropdown-horario\"\r\n                                value={selectedHorarios[materia.materia_id]?.combinacionId || \"\"}\r\n                                onChange={(e) =>\r\n                                    handleHorarioSelection(materia.materia_id, e.target.value, null)\r\n                                }\r\n                            >\r\n                                <option value=\"\" disabled>\r\n                                    Selecciona Días\r\n                                </option>\r\n                                {diasCombinaciones.map((combinacion) => (\r\n                                    <option key={combinacion.id} value={combinacion.id}>\r\n                                        {combinacion.dias.join(' y ')}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        )}\r\n                        {franjasHorarias.length > 0 && (\r\n                            <select\r\n                                className=\"dropdown-horario\"\r\n                                value={selectedHorarios[materia.materia_id]?.franjaId || \"\"}\r\n                                onChange={(e) =>\r\n                                    handleHorarioSelection(materia.materia_id, null, e.target.value)\r\n                                }\r\n                            >\r\n                                <option value=\"\" disabled>\r\n                                    Selecciona Horario\r\n                                </option>\r\n                                {franjasHorarias.map((franja) => (\r\n                                    <option key={franja.franja_id} value={franja.franja_id}>\r\n                                        {franja.hora_inicio} - {franja.hora_fin}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        )}\r\n                    </div>\r\n                ))}\r\n                <button className=\"boton-guardar\" onClick={handleSubmit}>Guardar Selección</button>\r\n            </div>\r\n        );\r\n    };\r\n\r\nexport default SeleccionHorarios;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}